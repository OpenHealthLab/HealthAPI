..FFF..FFF.F.FFF..F...FFFFF.FFF..FFFFFEEF                                [100%]
==================================== ERRORS ====================================
________________ ERROR at setup of test_protected_user_endpoint ________________

    @pytest.fixture
    async def registered_user():
        """
        Register a test user and obtain a JWT access token.
        Returns a dict with ``token`` and ``username``.
        """
        async with AsyncClient(app=app, base_url="http://test") as client:
            # Register
            register_payload = {
                "username": "testuser",
                "email": "testuser@example.com",
                "password": "StrongP@ssw0rd!"
            }
>           reg_resp = await client.post("/api/v2/auth/register", json=register_payload)

tests/test_v2_api.py:37: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/httpx/_client.py:1848: in post
    return await self.request(
env/lib/python3.12/site-packages/httpx/_client.py:1530: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:1617: in send
    response = await self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:1645: in _send_handling_auth
    response = await self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:1682: in _send_handling_redirects
    response = await self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1719: in _send_single_request
    response = await transport.handle_async_request(request)
env/lib/python3.12/site-packages/httpx/_transports/asgi.py:162: in handle_async_request
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
app/api/v2/auth.py:67: in register
    user = auth_service.register_user(db, user_data)
app/services/auth_service.py:50: in register_user
    existing_user = db.query(User).filter(
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

registries = set(), cascade = True

    @util.preload_module("sqlalchemy.orm.decl_api")
    def _do_configure_registries(
        registries: Set[_RegistryType], cascade: bool
    ) -> None:
        registry = util.preloaded.orm_decl_api.registry
    
        orig = set(registries)
    
        for reg in registry._recurse_with_dependencies(registries):
            has_skip = False
    
            for mapper in reg._mappers_to_configure():
                run_configure = None
    
                for fn in mapper.dispatch.before_mapper_configured:
                    run_configure = fn(mapper, mapper.class_)
                    if run_configure is EXT_SKIP:
                        has_skip = True
                        break
                if run_configure is EXT_SKIP:
                    continue
    
                if getattr(mapper, "_configure_failed", False):
                    e = sa_exc.InvalidRequestError(
                        "One or more mappers failed to initialize - "
                        "can't proceed with initialization of other "
                        "mappers. Triggering mapper: '%s'. "
                        "Original exception was: %s"
                        % (mapper, mapper._configure_failed)
                    )
                    e._configure_failed = mapper._configure_failed  # type: ignore
>                   raise e
E                   sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4255: InvalidRequestError
______________ ERROR at setup of test_role_creation_unauthorized _______________

    @pytest.fixture
    async def registered_user():
        """
        Register a test user and obtain a JWT access token.
        Returns a dict with ``token`` and ``username``.
        """
        async with AsyncClient(app=app, base_url="http://test") as client:
            # Register
            register_payload = {
                "username": "testuser",
                "email": "testuser@example.com",
                "password": "StrongP@ssw0rd!"
            }
>           reg_resp = await client.post("/api/v2/auth/register", json=register_payload)

tests/test_v2_api.py:37: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/httpx/_client.py:1848: in post
    return await self.request(
env/lib/python3.12/site-packages/httpx/_client.py:1530: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:1617: in send
    response = await self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:1645: in _send_handling_auth
    response = await self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:1682: in _send_handling_redirects
    response = await self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1719: in _send_single_request
    response = await transport.handle_async_request(request)
env/lib/python3.12/site-packages/httpx/_transports/asgi.py:162: in handle_async_request
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
app/api/v2/auth.py:67: in register
    user = auth_service.register_user(db, user_data)
app/services/auth_service.py:50: in register_user
    existing_user = db.query(User).filter(
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

registries = set(), cascade = True

    @util.preload_module("sqlalchemy.orm.decl_api")
    def _do_configure_registries(
        registries: Set[_RegistryType], cascade: bool
    ) -> None:
        registry = util.preloaded.orm_decl_api.registry
    
        orig = set(registries)
    
        for reg in registry._recurse_with_dependencies(registries):
            has_skip = False
    
            for mapper in reg._mappers_to_configure():
                run_configure = None
    
                for fn in mapper.dispatch.before_mapper_configured:
                    run_configure = fn(mapper, mapper.class_)
                    if run_configure is EXT_SKIP:
                        has_skip = True
                        break
                if run_configure is EXT_SKIP:
                    continue
    
                if getattr(mapper, "_configure_failed", False):
                    e = sa_exc.InvalidRequestError(
                        "One or more mappers failed to initialize - "
                        "can't proceed with initialization of other "
                        "mappers. Triggering mapper: '%s'. "
                        "Original exception was: %s"
                        % (mapper, mapper._configure_failed)
                    )
                    e._configure_failed = mapper._configure_failed  # type: ignore
>                   raise e
E                   sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4255: InvalidRequestError
=================================== FAILURES ===================================
__________________________ test_get_predictions_empty __________________________

self = <sqlalchemy.orm.relationships.JoinCondition object at 0x7f5598f6e450>

    def _determine_joins(self) -> None:
        """Determine the 'primaryjoin' and 'secondaryjoin' attributes,
        if not passed to the constructor already.
    
        This is based on analysis of the foreign key relationships
        between the parent and target mapped selectables.
    
        """
        if self.secondaryjoin is not None and self.secondary is None:
            raise sa_exc.ArgumentError(
                "Property %s specified with secondary "
                "join condition but "
                "no secondary argument" % self.prop
            )
    
        # find a join between the given mapper's mapped table and
        # the given table. will try the mapper's local table first
        # for more specificity, then if not found will try the more
        # general mapped table, which in the case of inheritance is
        # a join.
        try:
            consider_as_foreign_keys = self.consider_as_foreign_keys or None
            if self.secondary is not None:
                if self.secondaryjoin is None:
                    self.secondaryjoin = join_condition(
                        self.child_persist_selectable,
                        self.secondary,
                        a_subset=self.child_local_selectable,
                        consider_as_foreign_keys=consider_as_foreign_keys,
                    )
                if self.primaryjoin_initial is None:
                    self.primaryjoin = join_condition(
                        self.parent_persist_selectable,
                        self.secondary,
                        a_subset=self.parent_local_selectable,
                        consider_as_foreign_keys=consider_as_foreign_keys,
                    )
                else:
                    self.primaryjoin = self.primaryjoin_initial
            else:
                if self.primaryjoin_initial is None:
>                   self.primaryjoin = join_condition(
                        self.parent_persist_selectable,
                        self.child_persist_selectable,
                        a_subset=self.parent_local_selectable,
                        consider_as_foreign_keys=consider_as_foreign_keys,
                    )

env/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py:2434: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/sqlalchemy/sql/util.py:121: in join_condition
    return Join._join_condition(
env/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py:1435: in _join_condition
    cls._joincond_trim_constraints(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'sqlalchemy.sql.selectable.Join'>
a = Table('users', MetaData(), Column('id', Integer(), table=<users>, primary_key=True, nullable=False), Column('username'...sql.functions.now at 0x7f559aaeeea0; now>)), Column('last_login', DateTime(timezone=True), table=<users>), schema=None)
b = Table('user_roles', MetaData(), Column('user_id', Integer(), ForeignKey('users.id'), table=<user_roles>, primary_key=T...0; now>, for_update=False)), Column('assigned_by', Integer(), ForeignKey('users.id'), table=<user_roles>), schema=None)
constraints = defaultdict(<class 'list'>, {ForeignKeyConstraint(<sqlalchemy.sql.base.ReadOnlyColumnCollection object at 0x7f5598608b...s>, primary_key=True, nullable=False), Column('assigned_by', Integer(), ForeignKey('users.id'), table=<user_roles>))]})
consider_as_foreign_keys = None

    @classmethod
    def _joincond_trim_constraints(
        cls,
        a: FromClause,
        b: FromClause,
        constraints: Dict[Any, Any],
        consider_as_foreign_keys: Optional[Any],
    ) -> None:
        # more than one constraint matched.  narrow down the list
        # to include just those FKCs that match exactly to
        # "consider_as_foreign_keys".
        if consider_as_foreign_keys:
            for const in list(constraints):
                if {f.parent for f in const.elements} != set(
                    consider_as_foreign_keys
                ):
                    del constraints[const]
    
        # if still multiple constraints, but
        # they all refer to the exact same end result, use it.
        if len(constraints) > 1:
            dedupe = {tuple(crit) for crit in constraints.values()}
            if len(dedupe) == 1:
                key = list(constraints)[0]
                constraints = {key: constraints[key]}
    
        if len(constraints) != 1:
>           raise exc.AmbiguousForeignKeysError(
                "Can't determine join between '%s' and '%s'; "
                "tables have more than one foreign key "
                "constraint relationship between them. "
                "Please specify the 'onclause' of this "
                "join explicitly." % (a.description, b.description)
            )
E           sqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'users' and 'user_roles'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.

env/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py:1580: AmbiguousForeignKeysError

The above exception was the direct cause of the following exception:

    def test_get_predictions_empty():
        """Test getting predictions when database is empty."""
>       response = client.get("/api/v1/predictions")

tests/test_api.py:136: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/starlette/testclient.py:479: in get
    return super().get(
env/lib/python3.12/site-packages/httpx/_client.py:1041: in get
    return self.request(
env/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
env/lib/python3.12/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
env/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
env/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
env/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
env/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
env/lib/python3.12/site-packages/dependency_injector/wiring.py:1171: in _patched
    return await fn(*args, **kwargs)
app/api/routes/predictions.py:268: in get_all_predictions
    predictions = prediction_service.get_predictions(db, skip=skip, limit=limit)
app/services/prediction_service.py:47: in get_predictions
    return db.query(Prediction).offset(skip).limit(limit).all()
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4259: in _do_configure_registries
    mapper._post_configure_properties()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2418: in _post_configure_properties
    prop.init()
env/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py:595: in init
    self.do_init()
env/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py:1657: in do_init
    self._setup_join_conditions()
env/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py:1895: in _setup_join_conditions
    self._join_condition = jc = JoinCondition(
env/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py:2321: in __init__
    self._determine_joins()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.orm.relationships.JoinCondition object at 0x7f5598f6e450>

    def _determine_joins(self) -> None:
        """Determine the 'primaryjoin' and 'secondaryjoin' attributes,
        if not passed to the constructor already.
    
        This is based on analysis of the foreign key relationships
        between the parent and target mapped selectables.
    
        """
        if self.secondaryjoin is not None and self.secondary is None:
            raise sa_exc.ArgumentError(
                "Property %s specified with secondary "
                "join condition but "
                "no secondary argument" % self.prop
            )
    
        # find a join between the given mapper's mapped table and
        # the given table. will try the mapper's local table first
        # for more specificity, then if not found will try the more
        # general mapped table, which in the case of inheritance is
        # a join.
        try:
            consider_as_foreign_keys = self.consider_as_foreign_keys or None
            if self.secondary is not None:
                if self.secondaryjoin is None:
                    self.secondaryjoin = join_condition(
                        self.child_persist_selectable,
                        self.secondary,
                        a_subset=self.child_local_selectable,
                        consider_as_foreign_keys=consider_as_foreign_keys,
                    )
                if self.primaryjoin_initial is None:
                    self.primaryjoin = join_condition(
                        self.parent_persist_selectable,
                        self.secondary,
                        a_subset=self.parent_local_selectable,
                        consider_as_foreign_keys=consider_as_foreign_keys,
                    )
                else:
                    self.primaryjoin = self.primaryjoin_initial
            else:
                if self.primaryjoin_initial is None:
                    self.primaryjoin = join_condition(
                        self.parent_persist_selectable,
                        self.child_persist_selectable,
                        a_subset=self.parent_local_selectable,
                        consider_as_foreign_keys=consider_as_foreign_keys,
                    )
                else:
                    self.primaryjoin = self.primaryjoin_initial
        except sa_exc.NoForeignKeysError as nfe:
            if self.secondary is not None:
                raise sa_exc.NoForeignKeysError(
                    "Could not determine join "
                    "condition between parent/child tables on "
                    "relationship %s - there are no foreign keys "
                    "linking these tables via secondary table '%s'.  "
                    "Ensure that referencing columns are associated "
                    "with a ForeignKey or ForeignKeyConstraint, or "
                    "specify 'primaryjoin' and 'secondaryjoin' "
                    "expressions." % (self.prop, self.secondary)
                ) from nfe
            else:
                raise sa_exc.NoForeignKeysError(
                    "Could not determine join "
                    "condition between parent/child tables on "
                    "relationship %s - there are no foreign keys "
                    "linking these tables.  "
                    "Ensure that referencing columns are associated "
                    "with a ForeignKey or ForeignKeyConstraint, or "
                    "specify a 'primaryjoin' expression." % self.prop
                ) from nfe
        except sa_exc.AmbiguousForeignKeysError as afe:
            if self.secondary is not None:
                raise sa_exc.AmbiguousForeignKeysError(
                    "Could not determine join "
                    "condition between parent/child tables on "
                    "relationship %s - there are multiple foreign key "
                    "paths linking the tables via secondary table '%s'.  "
                    "Specify the 'foreign_keys' "
                    "argument, providing a list of those columns which "
                    "should be counted as containing a foreign key "
                    "reference from the secondary table to each of the "
                    "parent and child tables." % (self.prop, self.secondary)
                ) from afe
            else:
>               raise sa_exc.AmbiguousForeignKeysError(
                    "Could not determine join "
                    "condition between parent/child tables on "
                    "relationship %s - there are multiple foreign key "
                    "paths linking the tables.  Specify the "
                    "'foreign_keys' argument, providing a list of those "
                    "columns which should be counted as containing a "
                    "foreign key reference to the parent table." % self.prop
                ) from afe
E               sqlalchemy.exc.AmbiguousForeignKeysError: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py:2478: AmbiguousForeignKeysError
----------------------------- Captured stdout call -----------------------------
14:46:21 - INFO - Retrieving predictions (skip=0, limit=100)
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:267 Retrieving predictions (skip=0, limit=100)
_______________________ test_predict_chest_xray_success ________________________

    def test_predict_chest_xray_success():
        """Test successful chest X-ray prediction with valid image."""
        img = create_test_image(format="PNG", size=(224, 224))
    
        response = client.post(
            "/api/v1/predict",
            files={"file": ("test_xray.png", img, "image/png")}
        )
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:150: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:22 - INFO - Initializing ModelInference on device: cpu
14:46:22 - INFO - Received prediction request for file: test_xray.png
14:46:22 - INFO - File saved successfully to: ./uploads/11ebb823-4730-4eba-a0cb-2fdfa0130f96.png
14:46:22 - INFO - Processing image for prediction: 11ebb823-4730-4eba-a0cb-2fdfa0130f96.png
14:46:22 - INFO - Running model inference for: 11ebb823-4730-4eba-a0cb-2fdfa0130f96.png
14:46:22 - WARNING - Model not loaded, attempting to load...
14:46:22 - INFO - Loading classification model...
14:46:23 - WARNING - Model file not found at ./ml_models/chest_xray_model.pth
14:46:23 - WARNING - Using untrained model for demonstration purposes
14:46:23 - WARNING - Please train a model and save it to the specified path
14:46:23 - INFO - Model ready for inference on cpu
14:46:23 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.092s
14:46:23 - ERROR - Prediction error for 11ebb823-4730-4eba-a0cb-2fdfa0130f96.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:23 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.ml.inference:inference.py:50 Initializing ModelInference on device: cpu
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: test_xray.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/11ebb823-4730-4eba-a0cb-2fdfa0130f96.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 11ebb823-4730-4eba-a0cb-2fdfa0130f96.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 11ebb823-4730-4eba-a0cb-2fdfa0130f96.png
WARNING  app.ml.inference:inference.py:127 Model not loaded, attempting to load...
INFO     app.ml.inference:inference.py:68 Loading classification model...
WARNING  app.ml.inference:inference.py:83 Model file not found at ./ml_models/chest_xray_model.pth
WARNING  app.ml.inference:inference.py:84 Using untrained model for demonstration purposes
WARNING  app.ml.inference:inference.py:85 Please train a model and save it to the specified path
INFO     app.ml.inference:inference.py:91 Model ready for inference on cpu
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.092s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 11ebb823-4730-4eba-a0cb-2fdfa0130f96.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
_________________________ test_predict_chest_xray_jpeg _________________________

    def test_predict_chest_xray_jpeg():
        """Test prediction with JPEG image format."""
        img = create_test_image(format="JPEG", size=(512, 512))
    
        response = client.post(
            "/api/v1/predict",
            files={"file": ("chest_xray.jpg", img, "image/jpeg")}
        )
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:181: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:23 - INFO - Received prediction request for file: chest_xray.jpg
14:46:23 - INFO - File saved successfully to: ./uploads/8fac681c-353c-437d-822c-d424d69b954f.jpg
14:46:23 - INFO - Processing image for prediction: 8fac681c-353c-437d-822c-d424d69b954f.jpg
14:46:23 - INFO - Running model inference for: 8fac681c-353c-437d-822c-d424d69b954f.jpg
14:46:23 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.089s
14:46:23 - ERROR - Prediction error for 8fac681c-353c-437d-822c-d424d69b954f.jpg: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:23 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: chest_xray.jpg
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/8fac681c-353c-437d-822c-d424d69b954f.jpg
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 8fac681c-353c-437d-822c-d424d69b954f.jpg
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 8fac681c-353c-437d-822c-d424d69b954f.jpg
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.089s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 8fac681c-353c-437d-822c-d424d69b954f.jpg: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
_____________________ test_predict_chest_xray_small_image ______________________

    def test_predict_chest_xray_small_image():
        """Test prediction with very small image."""
        img = create_test_image(format="PNG", size=(32, 32))
    
        response = client.post(
            "/api/v1/predict",
            files={"file": ("small_xray.png", img, "image/png")}
        )
    
        # Should either succeed or fail gracefully
>       assert response.status_code in [201, 400, 422]
E       assert 500 in [201, 400, 422]
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:222: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:23 - INFO - Received prediction request for file: small_xray.png
14:46:23 - INFO - File saved successfully to: ./uploads/d8e9641d-fbea-4607-8e4e-df9580e446d8.png
14:46:23 - INFO - Processing image for prediction: d8e9641d-fbea-4607-8e4e-df9580e446d8.png
14:46:23 - INFO - Running model inference for: d8e9641d-fbea-4607-8e4e-df9580e446d8.png
14:46:23 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.078s
14:46:23 - ERROR - Prediction error for d8e9641d-fbea-4607-8e4e-df9580e446d8.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:23 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: small_xray.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/d8e9641d-fbea-4607-8e4e-df9580e446d8.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: d8e9641d-fbea-4607-8e4e-df9580e446d8.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: d8e9641d-fbea-4607-8e4e-df9580e446d8.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.078s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for d8e9641d-fbea-4607-8e4e-df9580e446d8.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
_____________________ test_get_predictions_with_pagination _____________________

    def test_get_predictions_with_pagination():
        """Test getting predictions with pagination parameters."""
        # Create some test predictions first
        for i in range(5):
            img = create_test_image()
            client.post(
                "/api/v1/predict",
                files={"file": (f"test_{i}.png", img, "image/png")}
            )
    
        # Test with pagination
>       response = client.get("/api/v1/predictions?skip=0&limit=3")

tests/test_api.py:236: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/starlette/testclient.py:479: in get
    return super().get(
env/lib/python3.12/site-packages/httpx/_client.py:1041: in get
    return self.request(
env/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
env/lib/python3.12/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
env/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
env/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
env/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
env/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
env/lib/python3.12/site-packages/dependency_injector/wiring.py:1171: in _patched
    return await fn(*args, **kwargs)
app/api/routes/predictions.py:268: in get_all_predictions
    predictions = prediction_service.get_predictions(db, skip=skip, limit=limit)
app/services/prediction_service.py:47: in get_predictions
    return db.query(Prediction).offset(skip).limit(limit).all()
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

registries = set(), cascade = True

    @util.preload_module("sqlalchemy.orm.decl_api")
    def _do_configure_registries(
        registries: Set[_RegistryType], cascade: bool
    ) -> None:
        registry = util.preloaded.orm_decl_api.registry
    
        orig = set(registries)
    
        for reg in registry._recurse_with_dependencies(registries):
            has_skip = False
    
            for mapper in reg._mappers_to_configure():
                run_configure = None
    
                for fn in mapper.dispatch.before_mapper_configured:
                    run_configure = fn(mapper, mapper.class_)
                    if run_configure is EXT_SKIP:
                        has_skip = True
                        break
                if run_configure is EXT_SKIP:
                    continue
    
                if getattr(mapper, "_configure_failed", False):
                    e = sa_exc.InvalidRequestError(
                        "One or more mappers failed to initialize - "
                        "can't proceed with initialization of other "
                        "mappers. Triggering mapper: '%s'. "
                        "Original exception was: %s"
                        % (mapper, mapper._configure_failed)
                    )
                    e._configure_failed = mapper._configure_failed  # type: ignore
>                   raise e
E                   sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4255: InvalidRequestError
----------------------------- Captured stdout call -----------------------------
14:46:24 - INFO - Received prediction request for file: test_0.png
14:46:24 - INFO - File saved successfully to: ./uploads/31623afc-5ee3-4bac-a7c8-7aed60d4ae55.png
14:46:24 - INFO - Processing image for prediction: 31623afc-5ee3-4bac-a7c8-7aed60d4ae55.png
14:46:24 - INFO - Running model inference for: 31623afc-5ee3-4bac-a7c8-7aed60d4ae55.png
14:46:24 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.069s
14:46:24 - ERROR - Prediction error for 31623afc-5ee3-4bac-a7c8-7aed60d4ae55.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:24 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:24 - INFO - Received prediction request for file: test_1.png
14:46:24 - INFO - File saved successfully to: ./uploads/a015613e-dcd3-423c-846a-0ba1155c47c1.png
14:46:24 - INFO - Processing image for prediction: a015613e-dcd3-423c-846a-0ba1155c47c1.png
14:46:24 - INFO - Running model inference for: a015613e-dcd3-423c-846a-0ba1155c47c1.png
14:46:24 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.082s
14:46:24 - ERROR - Prediction error for a015613e-dcd3-423c-846a-0ba1155c47c1.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:24 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:24 - INFO - Received prediction request for file: test_2.png
14:46:24 - INFO - File saved successfully to: ./uploads/5f17744f-bbdc-49ab-8dd7-2b5e45c2714d.png
14:46:24 - INFO - Processing image for prediction: 5f17744f-bbdc-49ab-8dd7-2b5e45c2714d.png
14:46:24 - INFO - Running model inference for: 5f17744f-bbdc-49ab-8dd7-2b5e45c2714d.png
14:46:24 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.114s
14:46:24 - ERROR - Prediction error for 5f17744f-bbdc-49ab-8dd7-2b5e45c2714d.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:24 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:24 - INFO - Received prediction request for file: test_3.png
14:46:24 - INFO - File saved successfully to: ./uploads/3a4f7b13-7a44-4044-9e62-8dd12c0f8f73.png
14:46:24 - INFO - Processing image for prediction: 3a4f7b13-7a44-4044-9e62-8dd12c0f8f73.png
14:46:24 - INFO - Running model inference for: 3a4f7b13-7a44-4044-9e62-8dd12c0f8f73.png
14:46:24 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.074s
14:46:24 - ERROR - Prediction error for 3a4f7b13-7a44-4044-9e62-8dd12c0f8f73.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:24 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:24 - INFO - Received prediction request for file: test_4.png
14:46:24 - INFO - File saved successfully to: ./uploads/913fff3c-31ac-476b-9fc0-5c963def365d.png
14:46:24 - INFO - Processing image for prediction: 913fff3c-31ac-476b-9fc0-5c963def365d.png
14:46:24 - INFO - Running model inference for: 913fff3c-31ac-476b-9fc0-5c963def365d.png
14:46:24 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.082s
14:46:24 - ERROR - Prediction error for 913fff3c-31ac-476b-9fc0-5c963def365d.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:24 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:24 - INFO - Retrieving predictions (skip=0, limit=3)
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: test_0.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/31623afc-5ee3-4bac-a7c8-7aed60d4ae55.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 31623afc-5ee3-4bac-a7c8-7aed60d4ae55.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 31623afc-5ee3-4bac-a7c8-7aed60d4ae55.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.069s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 31623afc-5ee3-4bac-a7c8-7aed60d4ae55.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: test_1.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/a015613e-dcd3-423c-846a-0ba1155c47c1.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: a015613e-dcd3-423c-846a-0ba1155c47c1.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: a015613e-dcd3-423c-846a-0ba1155c47c1.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.082s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for a015613e-dcd3-423c-846a-0ba1155c47c1.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: test_2.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/5f17744f-bbdc-49ab-8dd7-2b5e45c2714d.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 5f17744f-bbdc-49ab-8dd7-2b5e45c2714d.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 5f17744f-bbdc-49ab-8dd7-2b5e45c2714d.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.114s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 5f17744f-bbdc-49ab-8dd7-2b5e45c2714d.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: test_3.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/3a4f7b13-7a44-4044-9e62-8dd12c0f8f73.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 3a4f7b13-7a44-4044-9e62-8dd12c0f8f73.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 3a4f7b13-7a44-4044-9e62-8dd12c0f8f73.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.074s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 3a4f7b13-7a44-4044-9e62-8dd12c0f8f73.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: test_4.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/913fff3c-31ac-476b-9fc0-5c963def365d.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 913fff3c-31ac-476b-9fc0-5c963def365d.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 913fff3c-31ac-476b-9fc0-5c963def365d.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.082s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 913fff3c-31ac-476b-9fc0-5c963def365d.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:267 Retrieving predictions (skip=0, limit=3)
__________________________ test_predict_batch_success __________________________

    def test_predict_batch_success():
        """Test successful batch prediction with multiple images."""
        files = [
            ("files", (f"xray_{i}.png", create_test_image(), "image/png"))
            for i in range(3)
        ]
    
        response = client.post("/api/v1/predict/batch", files=files)
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:261: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:25 - INFO - Received batch prediction request with 3 files
14:46:25 - INFO - Starting batch processing...
14:46:25 - INFO - Saving 3 predictions to database...
14:46:25 - ERROR - Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:25 - INFO - HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:138 Received batch prediction request with 3 files
INFO     app.api.routes.predictions:predictions.py:161 Starting batch processing...
INFO     app.api.routes.predictions:predictions.py:230 Saving 3 predictions to database...
ERROR    app.api.routes.predictions:predictions.py:235 Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
_________________________ test_predict_batch_max_limit _________________________

    def test_predict_batch_max_limit():
        """Test batch prediction with maximum allowed images (50)."""
        files = [
            ("files", (f"xray_{i}.png", create_test_image(), "image/png"))
            for i in range(50)
        ]
    
        response = client.post("/api/v1/predict/batch", files=files)
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:294: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:26 - INFO - Received batch prediction request with 50 files
14:46:26 - INFO - Starting batch processing...
14:46:31 - INFO - Saving 50 predictions to database...
14:46:31 - ERROR - Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:31 - INFO - HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:138 Received batch prediction request with 50 files
INFO     app.api.routes.predictions:predictions.py:161 Starting batch processing...
INFO     app.api.routes.predictions:predictions.py:230 Saving 50 predictions to database...
ERROR    app.api.routes.predictions:predictions.py:235 Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
_______________________ test_predict_batch_mixed_formats _______________________

    def test_predict_batch_mixed_formats():
        """Test batch prediction with mixed image formats."""
        files = [
            ("files", ("xray_1.png", create_test_image(format="PNG"), "image/png")),
            ("files", ("xray_2.jpg", create_test_image(format="JPEG"), "image/jpeg")),
            ("files", ("xray_3.png", create_test_image(format="PNG"), "image/png")),
        ]
    
        response = client.post("/api/v1/predict/batch", files=files)
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:320: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:31 - INFO - Received batch prediction request with 3 files
14:46:31 - INFO - Starting batch processing...
14:46:31 - INFO - Saving 3 predictions to database...
14:46:31 - ERROR - Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:31 - INFO - HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:138 Received batch prediction request with 3 files
INFO     app.api.routes.predictions:predictions.py:161 Starting batch processing...
INFO     app.api.routes.predictions:predictions.py:230 Saving 3 predictions to database...
ERROR    app.api.routes.predictions:predictions.py:235 Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
______________________ test_predict_batch_partial_failure ______________________

    def test_predict_batch_partial_failure():
        """Test batch prediction with some invalid files."""
        files = [
            ("files", ("valid.png", create_test_image(), "image/png")),
            ("files", ("invalid.txt", io.BytesIO(b"invalid"), "text/plain")),
        ]
    
        response = client.post("/api/v1/predict/batch", files=files)
    
        # Should still return 201 with error details
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:333: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:31 - INFO - Received batch prediction request with 2 files
14:46:31 - INFO - Starting batch processing...
14:46:32 - WARNING - Invalid file type in batch: invalid.txt (text/plain)
14:46:32 - INFO - Saving 1 predictions to database...
14:46:32 - ERROR - Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:32 - INFO - HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:138 Received batch prediction request with 2 files
INFO     app.api.routes.predictions:predictions.py:161 Starting batch processing...
WARNING  app.api.routes.predictions:predictions.py:170 Invalid file type in batch: invalid.txt (text/plain)
INFO     app.api.routes.predictions:predictions.py:230 Saving 1 predictions to database...
ERROR    app.api.routes.predictions:predictions.py:235 Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
___________________________ test_cade_detect_success ___________________________

    def test_cade_detect_success():
        """Test successful CADe detection on chest X-ray."""
        img = create_test_image(format="PNG", size=(512, 512))
    
        response = client.post(
            "/api/v1/cade/detect",
            files={"file": ("xray.png", img, "image/png")}
        )
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:353: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:32 - INFO - Initializing DetectionInference on device: cpu
14:46:32 - INFO - Received CADe detection request for file: xray.png
14:46:32 - INFO - CADe file saved successfully: ./uploads/6e7558c8-0d63-4647-9021-ff77a3092c97.png
14:46:32 - INFO - Processing image for CADe detection: 6e7558c8-0d63-4647-9021-ff77a3092c97.png
14:46:32 - ERROR - CADe detection error for 6e7558c8-0d63-4647-9021-ff77a3092c97.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:32 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.ml.detection_inference:detection_inference.py:59 Initializing DetectionInference on device: cpu
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/6e7558c8-0d63-4647-9021-ff77a3092c97.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: 6e7558c8-0d63-4647-9021-ff77a3092c97.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for 6e7558c8-0d63-4647-9021-ff77a3092c97.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
______________________ test_cade_detection_bounding_boxes ______________________

    def test_cade_detection_bounding_boxes():
        """Test that detections contain valid bounding boxes."""
        img = create_test_image(format="PNG")
    
        response = client.post(
            "/api/v1/cade/detect",
            files={"file": ("xray.png", img, "image/png")}
        )
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:396: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:32 - INFO - Received CADe detection request for file: xray.png
14:46:32 - INFO - CADe file saved successfully: ./uploads/7ab1eb8f-c224-4c12-9bb5-f53a769bae1d.png
14:46:32 - INFO - Processing image for CADe detection: 7ab1eb8f-c224-4c12-9bb5-f53a769bae1d.png
14:46:32 - ERROR - CADe detection error for 7ab1eb8f-c224-4c12-9bb5-f53a769bae1d.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:32 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/7ab1eb8f-c224-4c12-9bb5-f53a769bae1d.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: 7ab1eb8f-c224-4c12-9bb5-f53a769bae1d.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for 7ab1eb8f-c224-4c12-9bb5-f53a769bae1d.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
______________________ test_get_detections_for_prediction ______________________

    def test_get_detections_for_prediction():
        """Test retrieving detections for a specific prediction."""
        # First create a prediction with detection
        img = create_test_image()
        pred_response = client.post(
            "/api/v1/cade/detect",
            files={"file": ("xray.png", img, "image/png")}
        )
    
>       assert pred_response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:486: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:33 - INFO - Received CADe detection request for file: xray.png
14:46:33 - INFO - CADe file saved successfully: ./uploads/b3124ea6-96e5-46af-87ea-9692d8aa0842.png
14:46:33 - INFO - Processing image for CADe detection: b3124ea6-96e5-46af-87ea-9692d8aa0842.png
14:46:33 - ERROR - CADe detection error for b3124ea6-96e5-46af-87ea-9692d8aa0842.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:33 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/b3124ea6-96e5-46af-87ea-9692d8aa0842.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: b3124ea6-96e5-46af-87ea-9692d8aa0842.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for b3124ea6-96e5-46af-87ea-9692d8aa0842.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
________________ test_get_detections_for_nonexistent_prediction ________________

    def test_get_detections_for_nonexistent_prediction():
        """Test retrieving detections for non-existent prediction ID."""
>       response = client.get("/api/v1/cade/detections/99999")

tests/test_api.py:499: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/starlette/testclient.py:479: in get
    return super().get(
env/lib/python3.12/site-packages/httpx/_client.py:1041: in get
    return self.request(
env/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
env/lib/python3.12/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
env/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
env/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
env/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
env/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
env/lib/python3.12/site-packages/dependency_injector/wiring.py:1171: in _patched
    return await fn(*args, **kwargs)
app/api/routes/cade.py:359: in get_detections_for_prediction
    detections = detection_service.get_detections_by_prediction(db, prediction_id)
app/services/detection_service.py:129: in get_detections_by_prediction
    detections = db.query(Detection).filter(
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

registries = set(), cascade = True

    @util.preload_module("sqlalchemy.orm.decl_api")
    def _do_configure_registries(
        registries: Set[_RegistryType], cascade: bool
    ) -> None:
        registry = util.preloaded.orm_decl_api.registry
    
        orig = set(registries)
    
        for reg in registry._recurse_with_dependencies(registries):
            has_skip = False
    
            for mapper in reg._mappers_to_configure():
                run_configure = None
    
                for fn in mapper.dispatch.before_mapper_configured:
                    run_configure = fn(mapper, mapper.class_)
                    if run_configure is EXT_SKIP:
                        has_skip = True
                        break
                if run_configure is EXT_SKIP:
                    continue
    
                if getattr(mapper, "_configure_failed", False):
                    e = sa_exc.InvalidRequestError(
                        "One or more mappers failed to initialize - "
                        "can't proceed with initialization of other "
                        "mappers. Triggering mapper: '%s'. "
                        "Original exception was: %s"
                        % (mapper, mapper._configure_failed)
                    )
                    e._configure_failed = mapper._configure_failed  # type: ignore
>                   raise e
E                   sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4255: InvalidRequestError
----------------------------- Captured stdout call -----------------------------
14:46:33 - INFO - Retrieving detections for prediction ID: 99999
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.cade:cade.py:358 Retrieving detections for prediction ID: 99999
________________________ test_get_all_detections_empty _________________________

    def test_get_all_detections_empty():
        """Test getting all detections when database is empty."""
>       response = client.get("/api/v1/cade/detections")

tests/test_api.py:508: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/starlette/testclient.py:479: in get
    return super().get(
env/lib/python3.12/site-packages/httpx/_client.py:1041: in get
    return self.request(
env/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
env/lib/python3.12/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
env/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
env/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
env/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
env/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
env/lib/python3.12/site-packages/dependency_injector/wiring.py:1171: in _patched
    return await fn(*args, **kwargs)
app/api/routes/cade.py:402: in get_all_detections
    detections = detection_service.get_all_detections(db, skip=skip, limit=limit)
app/services/detection_service.py:173: in get_all_detections
    detections = db.query(Detection).offset(skip).limit(limit).all()
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

registries = set(), cascade = True

    @util.preload_module("sqlalchemy.orm.decl_api")
    def _do_configure_registries(
        registries: Set[_RegistryType], cascade: bool
    ) -> None:
        registry = util.preloaded.orm_decl_api.registry
    
        orig = set(registries)
    
        for reg in registry._recurse_with_dependencies(registries):
            has_skip = False
    
            for mapper in reg._mappers_to_configure():
                run_configure = None
    
                for fn in mapper.dispatch.before_mapper_configured:
                    run_configure = fn(mapper, mapper.class_)
                    if run_configure is EXT_SKIP:
                        has_skip = True
                        break
                if run_configure is EXT_SKIP:
                    continue
    
                if getattr(mapper, "_configure_failed", False):
                    e = sa_exc.InvalidRequestError(
                        "One or more mappers failed to initialize - "
                        "can't proceed with initialization of other "
                        "mappers. Triggering mapper: '%s'. "
                        "Original exception was: %s"
                        % (mapper, mapper._configure_failed)
                    )
                    e._configure_failed = mapper._configure_failed  # type: ignore
>                   raise e
E                   sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4255: InvalidRequestError
----------------------------- Captured stdout call -----------------------------
14:46:34 - INFO - Retrieving all detections (skip=0, limit=100, finding_type=None)
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.cade:cade.py:395 Retrieving all detections (skip=0, limit=100, finding_type=None)
___________________ test_get_all_detections_with_pagination ____________________

    def test_get_all_detections_with_pagination():
        """Test getting all detections with pagination."""
        # Create some detections
        for i in range(5):
            img = create_test_image()
            client.post(
                "/api/v1/cade/detect",
                files={"file": (f"xray_{i}.png", img, "image/png")}
            )
    
        # Test pagination
>       response = client.get("/api/v1/cade/detections?skip=0&limit=10")

tests/test_api.py:524: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/starlette/testclient.py:479: in get
    return super().get(
env/lib/python3.12/site-packages/httpx/_client.py:1041: in get
    return self.request(
env/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
env/lib/python3.12/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
env/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
env/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
env/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
env/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
env/lib/python3.12/site-packages/dependency_injector/wiring.py:1171: in _patched
    return await fn(*args, **kwargs)
app/api/routes/cade.py:402: in get_all_detections
    detections = detection_service.get_all_detections(db, skip=skip, limit=limit)
app/services/detection_service.py:173: in get_all_detections
    detections = db.query(Detection).offset(skip).limit(limit).all()
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

registries = set(), cascade = True

    @util.preload_module("sqlalchemy.orm.decl_api")
    def _do_configure_registries(
        registries: Set[_RegistryType], cascade: bool
    ) -> None:
        registry = util.preloaded.orm_decl_api.registry
    
        orig = set(registries)
    
        for reg in registry._recurse_with_dependencies(registries):
            has_skip = False
    
            for mapper in reg._mappers_to_configure():
                run_configure = None
    
                for fn in mapper.dispatch.before_mapper_configured:
                    run_configure = fn(mapper, mapper.class_)
                    if run_configure is EXT_SKIP:
                        has_skip = True
                        break
                if run_configure is EXT_SKIP:
                    continue
    
                if getattr(mapper, "_configure_failed", False):
                    e = sa_exc.InvalidRequestError(
                        "One or more mappers failed to initialize - "
                        "can't proceed with initialization of other "
                        "mappers. Triggering mapper: '%s'. "
                        "Original exception was: %s"
                        % (mapper, mapper._configure_failed)
                    )
                    e._configure_failed = mapper._configure_failed  # type: ignore
>                   raise e
E                   sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4255: InvalidRequestError
----------------------------- Captured stdout call -----------------------------
14:46:35 - INFO - Received CADe detection request for file: xray_0.png
14:46:35 - INFO - CADe file saved successfully: ./uploads/744903ad-47e4-4d49-912a-9e810a3f7104.png
14:46:35 - INFO - Processing image for CADe detection: 744903ad-47e4-4d49-912a-9e810a3f7104.png
14:46:35 - ERROR - CADe detection error for 744903ad-47e4-4d49-912a-9e810a3f7104.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:35 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
14:46:35 - INFO - Received CADe detection request for file: xray_1.png
14:46:35 - INFO - CADe file saved successfully: ./uploads/7a9b412f-394a-4aea-8bec-553654a7b3cf.png
14:46:35 - INFO - Processing image for CADe detection: 7a9b412f-394a-4aea-8bec-553654a7b3cf.png
14:46:35 - ERROR - CADe detection error for 7a9b412f-394a-4aea-8bec-553654a7b3cf.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:35 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
14:46:35 - INFO - Received CADe detection request for file: xray_2.png
14:46:35 - INFO - CADe file saved successfully: ./uploads/270bdaf3-f0c0-43fe-9bd3-a60f0a28e21f.png
14:46:35 - INFO - Processing image for CADe detection: 270bdaf3-f0c0-43fe-9bd3-a60f0a28e21f.png
14:46:35 - ERROR - CADe detection error for 270bdaf3-f0c0-43fe-9bd3-a60f0a28e21f.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:35 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
14:46:35 - INFO - Received CADe detection request for file: xray_3.png
14:46:35 - INFO - CADe file saved successfully: ./uploads/3df17e13-1821-4815-a280-886560ac5295.png
14:46:35 - INFO - Processing image for CADe detection: 3df17e13-1821-4815-a280-886560ac5295.png
14:46:35 - ERROR - CADe detection error for 3df17e13-1821-4815-a280-886560ac5295.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:35 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
14:46:35 - INFO - Received CADe detection request for file: xray_4.png
14:46:35 - INFO - CADe file saved successfully: ./uploads/0e6da39e-8d58-441d-8d75-4399707f3a72.png
14:46:35 - INFO - Processing image for CADe detection: 0e6da39e-8d58-441d-8d75-4399707f3a72.png
14:46:35 - ERROR - CADe detection error for 0e6da39e-8d58-441d-8d75-4399707f3a72.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:35 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
14:46:35 - INFO - Retrieving all detections (skip=0, limit=10, finding_type=None)
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray_0.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/744903ad-47e4-4d49-912a-9e810a3f7104.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: 744903ad-47e4-4d49-912a-9e810a3f7104.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for 744903ad-47e4-4d49-912a-9e810a3f7104.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray_1.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/7a9b412f-394a-4aea-8bec-553654a7b3cf.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: 7a9b412f-394a-4aea-8bec-553654a7b3cf.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for 7a9b412f-394a-4aea-8bec-553654a7b3cf.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray_2.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/270bdaf3-f0c0-43fe-9bd3-a60f0a28e21f.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: 270bdaf3-f0c0-43fe-9bd3-a60f0a28e21f.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for 270bdaf3-f0c0-43fe-9bd3-a60f0a28e21f.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray_3.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/3df17e13-1821-4815-a280-886560ac5295.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: 3df17e13-1821-4815-a280-886560ac5295.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for 3df17e13-1821-4815-a280-886560ac5295.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray_4.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/0e6da39e-8d58-441d-8d75-4399707f3a72.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: 0e6da39e-8d58-441d-8d75-4399707f3a72.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for 0e6da39e-8d58-441d-8d75-4399707f3a72.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.cade:cade.py:395 Retrieving all detections (skip=0, limit=10, finding_type=None)
_____________________ test_get_all_detections_with_filter ______________________

    def test_get_all_detections_with_filter():
        """Test filtering detections by finding type."""
>       response = client.get("/api/v1/cade/detections?finding_type=Pneumothorax")

tests/test_api.py:536: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/starlette/testclient.py:479: in get
    return super().get(
env/lib/python3.12/site-packages/httpx/_client.py:1041: in get
    return self.request(
env/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
env/lib/python3.12/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
env/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
env/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
env/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
env/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
env/lib/python3.12/site-packages/dependency_injector/wiring.py:1171: in _patched
    return await fn(*args, **kwargs)
app/api/routes/cade.py:398: in get_all_detections
    detections = detection_service.get_detections_by_finding_type(
app/services/detection_service.py:196: in get_detections_by_finding_type
    detections = db.query(Detection).filter(
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

registries = set(), cascade = True

    @util.preload_module("sqlalchemy.orm.decl_api")
    def _do_configure_registries(
        registries: Set[_RegistryType], cascade: bool
    ) -> None:
        registry = util.preloaded.orm_decl_api.registry
    
        orig = set(registries)
    
        for reg in registry._recurse_with_dependencies(registries):
            has_skip = False
    
            for mapper in reg._mappers_to_configure():
                run_configure = None
    
                for fn in mapper.dispatch.before_mapper_configured:
                    run_configure = fn(mapper, mapper.class_)
                    if run_configure is EXT_SKIP:
                        has_skip = True
                        break
                if run_configure is EXT_SKIP:
                    continue
    
                if getattr(mapper, "_configure_failed", False):
                    e = sa_exc.InvalidRequestError(
                        "One or more mappers failed to initialize - "
                        "can't proceed with initialization of other "
                        "mappers. Triggering mapper: '%s'. "
                        "Original exception was: %s"
                        % (mapper, mapper._configure_failed)
                    )
                    e._configure_failed = mapper._configure_failed  # type: ignore
>                   raise e
E                   sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4255: InvalidRequestError
----------------------------- Captured stdout call -----------------------------
14:46:35 - INFO - Retrieving all detections (skip=0, limit=100, finding_type=Pneumothorax)
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.cade:cade.py:395 Retrieving all detections (skip=0, limit=100, finding_type=Pneumothorax)
_____________________ test_end_to_end_prediction_workflow ______________________

    def test_end_to_end_prediction_workflow():
        """Test complete workflow: predict -> retrieve -> verify."""
        # Step 1: Upload and predict
        img = create_test_image()
        pred_response = client.post(
            "/api/v1/predict",
            files={"file": ("test.png", img, "image/png")}
        )
    
>       assert pred_response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:571: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:37 - INFO - Received prediction request for file: test.png
14:46:37 - INFO - File saved successfully to: ./uploads/8ac7cfdf-2a77-44e5-82c9-a8f14d48dbf2.png
14:46:37 - INFO - Processing image for prediction: 8ac7cfdf-2a77-44e5-82c9-a8f14d48dbf2.png
14:46:37 - INFO - Running model inference for: 8ac7cfdf-2a77-44e5-82c9-a8f14d48dbf2.png
14:46:37 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.073s
14:46:37 - ERROR - Prediction error for 8ac7cfdf-2a77-44e5-82c9-a8f14d48dbf2.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:37 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: test.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/8ac7cfdf-2a77-44e5-82c9-a8f14d48dbf2.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 8ac7cfdf-2a77-44e5-82c9-a8f14d48dbf2.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 8ac7cfdf-2a77-44e5-82c9-a8f14d48dbf2.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.073s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 8ac7cfdf-2a77-44e5-82c9-a8f14d48dbf2.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
________________________ test_end_to_end_cade_workflow _________________________

    def test_end_to_end_cade_workflow():
        """Test complete CADe workflow: detect -> retrieve -> verify."""
        # Step 1: Run detection
        img = create_test_image()
        detect_response = client.post(
            "/api/v1/cade/detect",
            files={"file": ("xray.png", img, "image/png")}
        )
    
>       assert detect_response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:593: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:37 - INFO - Received CADe detection request for file: xray.png
14:46:37 - INFO - CADe file saved successfully: ./uploads/53b7db8e-63ab-490b-b481-49622256bb8c.png
14:46:37 - INFO - Processing image for CADe detection: 53b7db8e-63ab-490b-b481-49622256bb8c.png
14:46:37 - ERROR - CADe detection error for 53b7db8e-63ab-490b-b481-49622256bb8c.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:37 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/53b7db8e-63ab-490b-b481-49622256bb8c.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: 53b7db8e-63ab-490b-b481-49622256bb8c.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for 53b7db8e-63ab-490b-b481-49622256bb8c.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
_________________________ test_concurrent_predictions __________________________

    def test_concurrent_predictions():
        """Test handling multiple concurrent prediction requests."""
        files = [
            ("file", (f"xray_{i}.png", create_test_image(), "image/png"))
            for i in range(5)
        ]
    
        responses = []
        for file_tuple in files:
            response = client.post("/api/v1/predict", files=[file_tuple])
            responses.append(response)
    
        # All should succeed
        for response in responses:
>           assert response.status_code == 201
E           assert 500 == 201
E            +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:619: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:37 - INFO - Received prediction request for file: xray_0.png
14:46:37 - INFO - File saved successfully to: ./uploads/278520b6-86cb-4a15-9a1e-1125ac4af2cc.png
14:46:37 - INFO - Processing image for prediction: 278520b6-86cb-4a15-9a1e-1125ac4af2cc.png
14:46:37 - INFO - Running model inference for: 278520b6-86cb-4a15-9a1e-1125ac4af2cc.png
14:46:37 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.079s
14:46:37 - ERROR - Prediction error for 278520b6-86cb-4a15-9a1e-1125ac4af2cc.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:37 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:37 - INFO - Received prediction request for file: xray_1.png
14:46:37 - INFO - File saved successfully to: ./uploads/48a763ca-d3e0-47d2-bb35-52b1430d2928.png
14:46:37 - INFO - Processing image for prediction: 48a763ca-d3e0-47d2-bb35-52b1430d2928.png
14:46:37 - INFO - Running model inference for: 48a763ca-d3e0-47d2-bb35-52b1430d2928.png
14:46:37 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.079s
14:46:37 - ERROR - Prediction error for 48a763ca-d3e0-47d2-bb35-52b1430d2928.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:37 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:37 - INFO - Received prediction request for file: xray_2.png
14:46:37 - INFO - File saved successfully to: ./uploads/fcdbf482-758e-4f02-8f31-fcd2b69d3e48.png
14:46:37 - INFO - Processing image for prediction: fcdbf482-758e-4f02-8f31-fcd2b69d3e48.png
14:46:37 - INFO - Running model inference for: fcdbf482-758e-4f02-8f31-fcd2b69d3e48.png
14:46:37 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.076s
14:46:37 - ERROR - Prediction error for fcdbf482-758e-4f02-8f31-fcd2b69d3e48.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:37 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:37 - INFO - Received prediction request for file: xray_3.png
14:46:37 - INFO - File saved successfully to: ./uploads/46eb3daf-177e-4117-a570-c04ba9e110a5.png
14:46:37 - INFO - Processing image for prediction: 46eb3daf-177e-4117-a570-c04ba9e110a5.png
14:46:37 - INFO - Running model inference for: 46eb3daf-177e-4117-a570-c04ba9e110a5.png
14:46:37 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.077s
14:46:37 - ERROR - Prediction error for 46eb3daf-177e-4117-a570-c04ba9e110a5.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:37 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
14:46:37 - INFO - Received prediction request for file: xray_4.png
14:46:37 - INFO - File saved successfully to: ./uploads/3a658716-584e-4cb3-961b-9c68be25d98e.png
14:46:37 - INFO - Processing image for prediction: 3a658716-584e-4cb3-961b-9c68be25d98e.png
14:46:37 - INFO - Running model inference for: 3a658716-584e-4cb3-961b-9c68be25d98e.png
14:46:37 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.076s
14:46:37 - ERROR - Prediction error for 3a658716-584e-4cb3-961b-9c68be25d98e.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:37 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: xray_0.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/278520b6-86cb-4a15-9a1e-1125ac4af2cc.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 278520b6-86cb-4a15-9a1e-1125ac4af2cc.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 278520b6-86cb-4a15-9a1e-1125ac4af2cc.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.079s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 278520b6-86cb-4a15-9a1e-1125ac4af2cc.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: xray_1.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/48a763ca-d3e0-47d2-bb35-52b1430d2928.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 48a763ca-d3e0-47d2-bb35-52b1430d2928.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 48a763ca-d3e0-47d2-bb35-52b1430d2928.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.079s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 48a763ca-d3e0-47d2-bb35-52b1430d2928.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: xray_2.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/fcdbf482-758e-4f02-8f31-fcd2b69d3e48.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: fcdbf482-758e-4f02-8f31-fcd2b69d3e48.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: fcdbf482-758e-4f02-8f31-fcd2b69d3e48.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.076s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for fcdbf482-758e-4f02-8f31-fcd2b69d3e48.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: xray_3.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/46eb3daf-177e-4117-a570-c04ba9e110a5.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 46eb3daf-177e-4117-a570-c04ba9e110a5.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 46eb3daf-177e-4117-a570-c04ba9e110a5.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.077s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 46eb3daf-177e-4117-a570-c04ba9e110a5.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: xray_4.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/3a658716-584e-4cb3-961b-9c68be25d98e.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 3a658716-584e-4cb3-961b-9c68be25d98e.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 3a658716-584e-4cb3-961b-9c68be25d98e.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.076s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 3a658716-584e-4cb3-961b-9c68be25d98e.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
_______________________________ test_large_image _______________________________

    def test_large_image():
        """Test handling of very large image."""
        # Create a large image (4K resolution)
        large_img = create_test_image(format="PNG", size=(3840, 2160))
    
        response = client.post(
            "/api/v1/predict",
            files={"file": ("large.png", large_img, "image/png")}
        )
    
        # Should either succeed or fail gracefully
>       assert response.status_code in [201, 400, 413, 422]
E       assert 500 in [201, 400, 413, 422]
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:662: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:38 - INFO - Received prediction request for file: large.png
14:46:38 - INFO - File saved successfully to: ./uploads/3aa5f59e-6222-4025-ae62-32e55471f5ce.png
14:46:38 - INFO - Processing image for prediction: 3aa5f59e-6222-4025-ae62-32e55471f5ce.png
14:46:38 - INFO - Running model inference for: 3aa5f59e-6222-4025-ae62-32e55471f5ce.png
14:46:39 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.285s
14:46:39 - ERROR - Prediction error for 3aa5f59e-6222-4025-ae62-32e55471f5ce.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:39 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: large.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/3aa5f59e-6222-4025-ae62-32e55471f5ce.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 3aa5f59e-6222-4025-ae62-32e55471f5ce.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 3aa5f59e-6222-4025-ae62-32e55471f5ce.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.285s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 3aa5f59e-6222-4025-ae62-32e55471f5ce.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
__________________________ test_batch_processing_time __________________________

    def test_batch_processing_time():
        """Verify batch processing returns timing information."""
        files = [
            ("files", (f"xray_{i}.png", create_test_image(), "image/png"))
            for i in range(5)
        ]
    
        response = client.post("/api/v1/predict/batch", files=files)
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:678: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:39 - INFO - Received batch prediction request with 5 files
14:46:39 - INFO - Starting batch processing...
14:46:39 - INFO - Saving 5 predictions to database...
14:46:39 - ERROR - Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:39 - INFO - HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:138 Received batch prediction request with 5 files
INFO     app.api.routes.predictions:predictions.py:161 Starting batch processing...
INFO     app.api.routes.predictions:predictions.py:230 Saving 5 predictions to database...
ERROR    app.api.routes.predictions:predictions.py:235 Database error during batch save: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 231, in predict_chest_xray_batch
    db_predictions = prediction_service.create_predictions_batch(db, predictions_data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 30, in create_predictions_batch
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict/batch "HTTP/1.1 500 Internal Server Error"
________________________ test_single_prediction_timing _________________________

    def test_single_prediction_timing():
        """Verify individual predictions include timing."""
        img = create_test_image()
        response = client.post(
            "/api/v1/predict",
            files={"file": ("xray.png", img, "image/png")}
        )
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:697: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:39 - INFO - Received prediction request for file: xray.png
14:46:39 - INFO - File saved successfully to: ./uploads/ffe23756-0fae-4469-839b-61ee8a4525d0.png
14:46:39 - INFO - Processing image for prediction: ffe23756-0fae-4469-839b-61ee8a4525d0.png
14:46:39 - INFO - Running model inference for: ffe23756-0fae-4469-839b-61ee8a4525d0.png
14:46:39 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.075s
14:46:39 - ERROR - Prediction error for ffe23756-0fae-4469-839b-61ee8a4525d0.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:39 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: xray.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/ffe23756-0fae-4469-839b-61ee8a4525d0.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: ffe23756-0fae-4469-839b-61ee8a4525d0.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: ffe23756-0fae-4469-839b-61ee8a4525d0.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.075s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for ffe23756-0fae-4469-839b-61ee8a4525d0.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
_______________________ test_prediction_response_schema ________________________

    def test_prediction_response_schema():
        """Verify prediction response matches expected schema."""
        img = create_test_image()
        response = client.post(
            "/api/v1/predict",
            files={"file": ("test.png", img, "image/png")}
        )
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:717: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:39 - INFO - Received prediction request for file: test.png
14:46:39 - INFO - File saved successfully to: ./uploads/94ceedbc-d2c4-46f8-91eb-f8916744655b.png
14:46:39 - INFO - Processing image for prediction: 94ceedbc-d2c4-46f8-91eb-f8916744655b.png
14:46:39 - INFO - Running model inference for: 94ceedbc-d2c4-46f8-91eb-f8916744655b.png
14:46:39 - INFO - Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.071s
14:46:39 - ERROR - Prediction error for 94ceedbc-d2c4-46f8-91eb-f8916744655b.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:39 - INFO - HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.predictions:predictions.py:39 Received prediction request for file: test.png
INFO     app.api.routes.predictions:predictions.py:63 File saved successfully to: ./uploads/94ceedbc-d2c4-46f8-91eb-f8916744655b.png
INFO     app.api.routes.predictions:predictions.py:83 Processing image for prediction: 94ceedbc-d2c4-46f8-91eb-f8916744655b.png
INFO     app.api.routes.predictions:predictions.py:91 Running model inference for: 94ceedbc-d2c4-46f8-91eb-f8916744655b.png
INFO     app.api.routes.predictions:predictions.py:94 Prediction completed - Class: Pneumonia, Confidence: 0.3562, Time: 0.071s
ERROR    app.api.routes.predictions:predictions.py:113 Prediction error for 94ceedbc-d2c4-46f8-91eb-f8916744655b.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/predictions.py", line 107, in predict_chest_xray
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/predict "HTTP/1.1 500 Internal Server Error"
__________________________ test_cade_response_schema ___________________________

    def test_cade_response_schema():
        """Verify CADe response matches expected schema."""
        img = create_test_image()
        response = client.post(
            "/api/v1/cade/detect",
            files={"file": ("xray.png", img, "image/png")}
        )
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/test_api.py:743: AssertionError
----------------------------- Captured stdout call -----------------------------
14:46:40 - INFO - Received CADe detection request for file: xray.png
14:46:40 - INFO - CADe file saved successfully: ./uploads/abcbb2db-a141-4a29-8f68-f9caa49b4f96.png
14:46:40 - INFO - Processing image for CADe detection: abcbb2db-a141-4a29-8f68-f9caa49b4f96.png
14:46:40 - ERROR - CADe detection error for abcbb2db-a141-4a29-8f68-f9caa49b4f96.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
14:46:40 - INFO - HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
------------------------------ Captured log call -------------------------------
INFO     app.api.routes.cade:cade.py:61 Received CADe detection request for file: xray.png
INFO     app.api.routes.cade:cade.py:85 CADe file saved successfully: ./uploads/abcbb2db-a141-4a29-8f68-f9caa49b4f96.png
INFO     app.api.routes.cade:cade.py:105 Processing image for CADe detection: abcbb2db-a141-4a29-8f68-f9caa49b4f96.png
ERROR    app.api.routes.cade:cade.py:175 CADe detection error for abcbb2db-a141-4a29-8f68-f9caa49b4f96.png: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
Traceback (most recent call last):
  File "/home/lucky/OpenHealth/HealthAPI/app/api/routes/cade.py", line 123, in detect_findings
    db_prediction = prediction_service.create_prediction(db, prediction_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky/OpenHealth/HealthAPI/app/services/prediction_service.py", line 20, in create_prediction
    db_prediction = Prediction(**prediction_data.model_dump())
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __init__
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 566, in _initialize_instance
    manager.dispatch.init(self, args, kwargs)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/event/attr.py", line 515, in __call__
    fn(*args, **kw)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4410, in _event_on_init
    instrumenting_mapper._check_configure()
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2401, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4218, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4255, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.
INFO     httpx:_client.py:1013 HTTP Request: POST http://testserver/api/v1/cade/detect "HTTP/1.1 500 Internal Server Error"
____________________________ test_login_rate_limit _____________________________

    @pytest.mark.anyio
    async def test_login_rate_limit():
        """
        The login endpoint is limited to 5 requests per minute.
        The sixth rapid request should receive a 429 response.
        """
        async with AsyncClient(app=app, base_url="http://test") as client:
            login_payload = {"username": "nonexistent", "password": "invalid"}
            # Perform 5 allowed attempts
            for _ in range(5):
>               resp = await client.post("/api/v2/auth/login", json=login_payload)

tests/test_v2_api.py:95: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.12/site-packages/httpx/_client.py:1848: in post
    return await self.request(
env/lib/python3.12/site-packages/httpx/_client.py:1530: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
env/lib/python3.12/site-packages/httpx/_client.py:1617: in send
    response = await self._send_handling_auth(
env/lib/python3.12/site-packages/httpx/_client.py:1645: in _send_handling_auth
    response = await self._send_handling_redirects(
env/lib/python3.12/site-packages/httpx/_client.py:1682: in _send_handling_redirects
    response = await self._send_single_request(request)
env/lib/python3.12/site-packages/httpx/_client.py:1719: in _send_single_request
    response = await transport.handle_async_request(request)
env/lib/python3.12/site-packages/httpx/_transports/asgi.py:162: in handle_async_request
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
env/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
env/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
env/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
env/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
env/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
env/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
env/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
env/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
env/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
env/lib/python3.12/site-packages/fastapi/routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
app/api/v2/auth.py:123: in login
    tokens, requires_2fa = auth_service.login(
app/services/auth_service.py:244: in login
    user = self.authenticate_user(db, credentials.username, credentials.password)
app/services/auth_service.py:133: in authenticate_user
    user = db.query(User).filter(
env/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2941: in query
    return self._query_cls(entities, self, **kwargs)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:276: in __init__
    self._set_entities(entities)
env/lib/python3.12/site-packages/sqlalchemy/orm/query.py:289: in _set_entities
    coercions.expect(
env/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py:388: in expect
    insp._post_inspect
env/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:1338: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2724: in _post_inspect
    self._check_configure()
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:2401: in _check_configure
    _configure_registries({self.registry}, cascade=True)
env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4218: in _configure_registries
    _do_configure_registries(registries, cascade)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

registries = set(), cascade = True

    @util.preload_module("sqlalchemy.orm.decl_api")
    def _do_configure_registries(
        registries: Set[_RegistryType], cascade: bool
    ) -> None:
        registry = util.preloaded.orm_decl_api.registry
    
        orig = set(registries)
    
        for reg in registry._recurse_with_dependencies(registries):
            has_skip = False
    
            for mapper in reg._mappers_to_configure():
                run_configure = None
    
                for fn in mapper.dispatch.before_mapper_configured:
                    run_configure = fn(mapper, mapper.class_)
                    if run_configure is EXT_SKIP:
                        has_skip = True
                        break
                if run_configure is EXT_SKIP:
                    continue
    
                if getattr(mapper, "_configure_failed", False):
                    e = sa_exc.InvalidRequestError(
                        "One or more mappers failed to initialize - "
                        "can't proceed with initialization of other "
                        "mappers. Triggering mapper: '%s'. "
                        "Original exception was: %s"
                        % (mapper, mapper._configure_failed)
                    )
                    e._configure_failed = mapper._configure_failed  # type: ignore
>                   raise e
E                   sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[User(users)]'. Original exception was: Could not determine join condition between parent/child tables on relationship User.roles - there are multiple foreign key paths linking the tables.  Specify the 'foreign_keys' argument, providing a list of those columns which should be counted as containing a foreign key reference to the parent table.

env/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py:4255: InvalidRequestError
=============================== warnings summary ===============================
app/schemas/auth.py:19
  /home/lucky/OpenHealth/HealthAPI/app/schemas/auth.py:19: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('username')

env/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

tests/test_api.py::test_predict_chest_xray_success
  /home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
    warnings.warn(

tests/test_api.py::test_predict_chest_xray_success
  /home/lucky/OpenHealth/HealthAPI/env/lib/python3.12/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=None`.
    warnings.warn(msg)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_api.py::test_get_predictions_empty - sqlalchemy.exc.Ambiguo...
FAILED tests/test_api.py::test_predict_chest_xray_success - assert 500 == 201
FAILED tests/test_api.py::test_predict_chest_xray_jpeg - assert 500 == 201
FAILED tests/test_api.py::test_predict_chest_xray_small_image - assert 500 in...
FAILED tests/test_api.py::test_get_predictions_with_pagination - sqlalchemy.e...
FAILED tests/test_api.py::test_predict_batch_success - assert 500 == 201
FAILED tests/test_api.py::test_predict_batch_max_limit - assert 500 == 201
FAILED tests/test_api.py::test_predict_batch_mixed_formats - assert 500 == 201
FAILED tests/test_api.py::test_predict_batch_partial_failure - assert 500 == 201
FAILED tests/test_api.py::test_cade_detect_success - assert 500 == 201
FAILED tests/test_api.py::test_cade_detection_bounding_boxes - assert 500 == 201
FAILED tests/test_api.py::test_get_detections_for_prediction - assert 500 == 201
FAILED tests/test_api.py::test_get_detections_for_nonexistent_prediction - sq...
FAILED tests/test_api.py::test_get_all_detections_empty - sqlalchemy.exc.Inva...
FAILED tests/test_api.py::test_get_all_detections_with_pagination - sqlalchem...
FAILED tests/test_api.py::test_get_all_detections_with_filter - sqlalchemy.ex...
FAILED tests/test_api.py::test_end_to_end_prediction_workflow - assert 500 ==...
FAILED tests/test_api.py::test_end_to_end_cade_workflow - assert 500 == 201
FAILED tests/test_api.py::test_concurrent_predictions - assert 500 == 201
FAILED tests/test_api.py::test_large_image - assert 500 in [201, 400, 413, 422]
FAILED tests/test_api.py::test_batch_processing_time - assert 500 == 201
FAILED tests/test_api.py::test_single_prediction_timing - assert 500 == 201
FAILED tests/test_api.py::test_prediction_response_schema - assert 500 == 201
FAILED tests/test_api.py::test_cade_response_schema - assert 500 == 201
FAILED tests/test_v2_api.py::test_login_rate_limit - sqlalchemy.exc.InvalidRe...
ERROR tests/test_v2_api.py::test_protected_user_endpoint - sqlalchemy.exc.Inv...
ERROR tests/test_v2_api.py::test_role_creation_unauthorized - sqlalchemy.exc....
25 failed, 14 passed, 4 warnings, 2 errors in 28.60s
